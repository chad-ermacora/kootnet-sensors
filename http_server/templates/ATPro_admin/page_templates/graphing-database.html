<style>
    input, form {
        display: inline-block;
    }
</style>

<div class="row">
    <div class="col-6 col-m-12 col-sm-12">
        <div class="counter bg-success">
            <form class="pure-form" method="POST" action="/atpro/graphing-create-plotly">
                <h2>Plotly Graphing</h2>
                <p>Use this to create graphs based on recorded data.</p>
                _<b id="blink_shadow" style="font-size: medium;"></b>_

                <br><br>

                <label for="databases">Choose a Database:<br>
                    <select onchange="db_selection()" name="SQLDatabaseSelection" id="databases">
                        <optgroup label="Local Databases">
                            <option value="MainDatabase">Main</option>
                            <option value="MQTTSubscriberDatabase">MQTT Subscriber</option>
                        </optgroup>
                        <optgroup label="Uploaded Databases">
                            {{ UploadedDBOptionNames |safe }}
                        </optgroup>
                    </select>
                </label>

                <br><br>

                <a href="/atpro/system-db-uploads">Click Here to Upload Databases</a>

                <br><br>

                <label class="toggle-switch">
                    <input type="checkbox" id="MQTTDatabaseCheck" class="toggle-switch-input"
                           name="MQTTDatabaseCheck" disabled>
                    <label class="toggle-switch-label" for="MQTTDatabaseCheck"></label>
                    MQTT Subscriber Database
                </label>

                <br><br>

                <label>Remote Sensor ID<br>
                    <div style="display: table; margin-left: auto; margin-right: auto;">
                        <div style="display: table-row;">
                            <div style="display: table-cell;">
                                <input style="width: 375px;" type="text" id="MQTTBaseTopicInput"
                                       maxlength="128" name="MQTTCustomBaseTopic" value="KS" disabled>
                            </div>
                        </div>
                    </div>
                </label>

                <br>

                <div style="display: table; margin-left: auto; margin-right: auto;">
                    <div style="display: table-row;">
                        <div style="display: table-cell;">
                            <h3>SQL Recording Type</h3>
                            <label for="rec-type-interval" class="pure-radio">
                                <input type="radio" id="rec-type-interval" name="SQLRecordingType" value="IntervalData" checked/>
                                Interval
                            </label>
                            <label for="rec-type-trigger" class="pure-radio">
                                <input type="radio" id="rec-type-trigger" name="SQLRecordingType" value="TriggerData"/>
                                Trigger
                            </label>
                        </div>

                        <div style="display: table-cell;">
                            <h3>Render Engine</h3>
                            <label for="render-type-ogl" class="pure-radio">
                                <input type="radio" id="render-type-ogl" name="PlotlyRenderType" value="OpenGL" checked/>
                                WebGL (Recommended)
                            </label>
                            <label for="render-type-cpu" class="pure-radio">
                                <input type="radio" id="render-type-cpu" name="PlotlyRenderType" value="CPU"/>
                                CPU
                            </label>
                        </div>
                    </div>
                </div>

                <br><br>

                <div style="display: table; margin-left: auto; margin-right: auto;">
                    <div style="display: table-row;">
                        <div style="display: table-cell;">
                            <label>Max Plot Points<br>
                                <input style="width: 125px;" type="number" min="5" name="MaxSQLData" value="200000">
                            </label>
                        </div>

                        &nbsp;&nbsp;&nbsp;

                        <div style="display: table-cell;">
                            <label>Skip Data between plots (Interval Only)<br>
                                <div style="display: table; margin-left: auto; margin-right: auto;">
                                    <div style="display: table-row;">
                                        <div style="display: table-cell;">
                                            <input style="width: 75px;" type="number" min="0" max="9999" name="SkipSQL" value="12">
                                        </div>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <br><hr><br>

                <label>Start DateTime DD/MM/YYYY hh:mm<br>
                    <div style="display: table; margin-left: auto; margin-right: auto;">
                        <div style="display: table-row;">
                            <div style="display: table-cell;">
                                <input type="datetime-local" name="graph_datetime_start" value="2019-07-01T00:00">
                            </div>
                        </div>
                    </div>
                </label>

                <br><br>

                <label>End DateTime DD/MM/YYYY hh:mm<br>
                    <div style="display: table; margin-left: auto; margin-right: auto;">
                        <div style="display: table-row;">
                            <div style="display: table-cell;">
                                <input type="datetime-local" name="graph_datetime_end" value="2200-01-01T00:00">
                            </div>
                        </div>
                    </div>
                </label>

                <br><br>


                <label>Hour Offset<br>
                    (Database saves in UTC 0)<br>
                    <div style="display: table; margin-left: auto; margin-right: auto;">
                        <div style="display: table-row;">
                            <div style="display: table-cell;">
                                <input style="width: 75px;" type="number" min="-12" max="14" name="HourOffset" value="{{ UTCOffset }}">
                            </div>
                        </div>
                    </div>
                </label>


                <br><hr><br>

                <label class="toggle-switch">
                    <input type="checkbox" id="select-all-checkboxes" class="toggle-switch-input">
                    <label class="toggle-switch-label" for="select-all-checkboxes"></label>
                    Select All
                </label>

                <br>

                <div id="sensor-checkboxes">
                    <label class="toggle-switch">
                        <input type="checkbox" id="uptime-toggle" class="toggle-switch-input"
                               name="sensor_uptime" checked>
                        <label class="toggle-switch-label" for="uptime-toggle"></label>
                        Sensor Uptime
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="cpu-temp-toggle" class="toggle-switch-input"
                               name="cpu_temperature" checked>
                        <label class="toggle-switch-label" for="cpu-temp-toggle"></label>
                        CPU Temperature
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="env-temp-toggle" class="toggle-switch-input"
                               name="env_temperature" checked>
                        <label class="toggle-switch-label" for="env-temp-toggle"></label>
                        Env Temperature
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="pressure-toggle" class="toggle-switch-input"
                               name="pressure" checked>
                        <label class="toggle-switch-label" for="pressure-toggle"></label>
                        Pressure
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="altitude-toggle" class="toggle-switch-input"
                               name="altitude" checked>
                        <label class="toggle-switch-label" for="altitude-toggle"></label>
                        Altitude
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="humidity-toggle" class="toggle-switch-input"
                               name="humidity" checked>
                        <label class="toggle-switch-label" for="humidity-toggle"></label>
                        Humidity
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="dew-point-toggle" class="toggle-switch-input"
                               name="dew_point" checked>
                        <label class="toggle-switch-label" for="dew-point-toggle"></label>
                        Dew Point
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="distance-toggle" class="toggle-switch-input"
                               name="distance" checked>
                        <label class="toggle-switch-label" for="distance-toggle"></label>
                        Distance
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="gas-toggle" class="toggle-switch-input"
                               name="gas" checked>
                        <label class="toggle-switch-label" for="gas-toggle"></label>
                        Gas
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="pm-toggle" class="toggle-switch-input"
                               name="particulate_matter" checked>
                        <label class="toggle-switch-label" for="pm-toggle"></label>
                        Particulate Matter
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="lumen-toggle" class="toggle-switch-input"
                               name="lumen" checked>
                        <label class="toggle-switch-label" for="lumen-toggle"></label>
                        Lumen
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="colour-toggle" class="toggle-switch-input"
                               name="colour" checked>
                        <label class="toggle-switch-label" for="colour-toggle"></label>
                        Colour
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="uv-toggle" class="toggle-switch-input"
                               name="ultra_violet" checked>
                        <label class="toggle-switch-label" for="uv-toggle"></label>
                        Ultra Violet
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="acc-toggle" class="toggle-switch-input"
                               name="accelerometer" checked>
                        <label class="toggle-switch-label" for="acc-toggle"></label>
                        Accelerometer
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="mag-toggle" class="toggle-switch-input"
                               name="magnetometer" checked>
                        <label class="toggle-switch-label" for="mag-toggle"></label>
                        Magnetometer
                    </label>

                    <label class="toggle-switch">
                        <input type="checkbox" id="gyroscope-toggle" class="toggle-switch-input"
                               name="gyroscope" checked>
                        <label class="toggle-switch-label" for="gyroscope-toggle"></label>
                        Gyroscope
                    </label>
                </div>

                <br><br>

                <button type="submit" id="create-graph-button" class="pure-button">Create Graph</button>
            </form>
        </div>
    </div>

    <div class="col-6 col-m-12 col-sm-12">
        <div class="counter bg-success">
            <h2>View Generated Graphs</h2>
            <p>To view generated graphs, click the links below.</p>

            <h3>
                <u><a href="/ViewIntervalPlotlyGraph" target="_blank">Interval Plotly Graph</a></u><br>
                Created: {{ IntervalPlotlyDate }}
            </h3>
            <h3>
                <u><a href="/ViewTriggerPlotlyGraph" target="_blank">Trigger Plotly Graph</a></u><br>
                Created: {{ TriggerPlotlyDate }}
            </h3>
            <h3>
                <u><a href="/ViewMQTTPlotlyGraph" target="_blank">MQTT Plotly Graph</a></u><br>
                Created: {{ MQTTPlotlyDate }}
            </h3>
            <h3>
                <u><a href="/ViewCustomPlotlyGraph" target="_blank">Custom Database Plotly Graph</a></u><br>
                Created: {{ CustomPlotlyDate }}
            </h3>
        </div>
    </div>
</div>

<script>
    jQuery('#select-all-checkboxes').change(function () {
        if (jQuery(this).prop('checked')) {
            jQuery("div[id=sensor-checkboxes] input:checkbox").prop('checked', true);
        } else {
            jQuery("div[id=sensor-checkboxes] input:checkbox").prop('checked', false);
        }
    });

    jQuery('#MQTTDatabaseCheck').change(function () {
        if (jQuery(this).prop('checked')) {
            document.getElementById("MQTTBaseTopicInput").disabled = false;
        } else {
            document.getElementById("MQTTBaseTopicInput").disabled = true;
        }
    });

    function db_selection() {
        if (document.getElementById("databases").value === 'MainDatabase') {
            jQuery(document.getElementById("MQTTDatabaseCheck")).prop('checked', false);
            document.getElementById("MQTTDatabaseCheck").disabled = true;
            document.getElementById("MQTTBaseTopicInput").disabled = true;
        } else if (document.getElementById("databases").value === 'MQTTSubscriberDatabase') {
            document.getElementById("MQTTDatabaseCheck").checked = true;
            document.getElementById("MQTTDatabaseCheck").disabled = false;
            document.getElementById("MQTTBaseTopicInput").disabled = false;
        }
        else {
            document.getElementById("MQTTDatabaseCheck").disabled = false;
            if (jQuery(document.getElementById("MQTTDatabaseCheck")).prop('checked')) {
                document.getElementById("MQTTBaseTopicInput").disabled = false;
            }
        }
    }
</script>

<script type="text/javascript">
    function CreatingGraph() {
        document.getElementById("blink_shadow").textContent = "Creating Graph - Please Wait";
        document.getElementById("create-graph-button").disabled = true;
        var blinks = document.getElementById("blink_shadow");
        var shadow_colour = "green";
        window.setTimeout(RefreshPageTimed, 10000);
        window.setInterval(function () {
            blinks.style.color = shadow_colour;
            shadow_colour = (shadow_colour === "green") ? "red" : "green";
        }, 1000);
    }

    function RefreshPageTimed() {
        SelectNav("sensor-graphing-db");
    }

    if (screen.width < 500) {
        document.getElementById('MQTTBaseTopicInput').style.width = '325px';
    }

    {{ RunScript | safe }}
</script>
